2025-03-22 16:57:18,254 - memory_debug - INFO - ============================================================
2025-03-22 16:57:18,254 - memory_debug - INFO - A-MEM Memory Creation Debugger
2025-03-22 16:57:18,254 - memory_debug - INFO - ============================================================
2025-03-22 16:57:18,256 - memory_debug - INFO - Testing memory creation directly using AgenticMemorySystem...
2025-03-22 16:57:19,761 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-03-22 16:57:19,761 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\zsun2\\AppData\\Roaming\\Python\\Python313\\site-packages\\certifi\\cacert.pem'
2025-03-22 16:57:20,150 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-03-22 16:57:20,151 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\zsun2\\AppData\\Roaming\\Python\\Python313\\site-packages\\certifi\\cacert.pem'
2025-03-22 16:57:20,537 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-03-22 16:57:20,538 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\zsun2\\AppData\\Roaming\\Python\\Python313\\site-packages\\certifi\\cacert.pem'
2025-03-22 16:57:20,926 - httpcore.connection - DEBUG - connect_tcp.started host='raw.githubusercontent.com' port=443 local_address=None timeout=5 socket_options=None
2025-03-22 16:57:20,951 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000200070B5940>
2025-03-22 16:57:20,959 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000020006C2F5C0> server_hostname='raw.githubusercontent.com' timeout=5
2025-03-22 16:57:21,458 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000020006C625D0>
2025-03-22 16:57:21,459 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-03-22 16:57:21,461 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-03-22 16:57:21,462 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-03-22 16:57:21,463 - httpcore.http11 - DEBUG - send_request_body.complete
2025-03-22 16:57:21,465 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-03-22 16:57:21,726 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Connection', b'keep-alive'), (b'Content-Length', b'18288'), (b'Cache-Control', b'max-age=300'), (b'Content-Security-Policy', b"default-src 'none'; style-src 'unsafe-inline'; sandbox"), (b'Content-Type', b'text/plain; charset=utf-8'), (b'ETag', b'W/"f0e2cfd347bc54b6240e458e8000d2867f21ed7a5d603a3d9f4b6a6590eb9218"'), (b'Strict-Transport-Security', b'max-age=31536000'), (b'X-Content-Type-Options', b'nosniff'), (b'X-Frame-Options', b'deny'), (b'X-XSS-Protection', b'1; mode=block'), (b'X-GitHub-Request-Id', b'9868:14AB20:7F4A9D:9FA3BB:67DE3444'), (b'Content-Encoding', b'gzip'), (b'Accept-Ranges', b'bytes'), (b'Date', b'Sat, 22 Mar 2025 08:57:20 GMT'), (b'Via', b'1.1 varnish'), (b'X-Served-By', b'cache-gnv1820022-GNV'), (b'X-Cache', b'HIT'), (b'X-Cache-Hits', b'1'), (b'X-Timer', b'S1742633840.302664,VS0,VE1'), (b'Vary', b'Authorization,Accept-Encoding,Origin'), (b'Access-Control-Allow-Origin', b'*'), (b'Cross-Origin-Resource-Policy', b'cross-origin'), (b'X-Fastly-Request-ID', b'da5f0dd8215611358121333f89dae2f91df117a5'), (b'Expires', b'Sat, 22 Mar 2025 09:02:20 GMT'), (b'Source-Age', b'129')])
2025-03-22 16:57:21,727 - httpx - INFO - HTTP Request: GET https://raw.githubusercontent.com/BerriAI/litellm/main/model_prices_and_context_window.json "HTTP/1.1 200 OK"
2025-03-22 16:57:21,728 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-03-22 16:57:21,857 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-03-22 16:57:21,858 - httpcore.http11 - DEBUG - response_closed.started
2025-03-22 16:57:21,858 - httpcore.http11 - DEBUG - response_closed.complete
2025-03-22 16:57:21,859 - httpcore.connection - DEBUG - close.started
2025-03-22 16:57:21,859 - httpcore.connection - DEBUG - close.complete
2025-03-22 16:57:22,147 - asyncio - DEBUG - Using proactor: IocpProactor
2025-03-22 16:57:22,148 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-03-22 16:57:22,149 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\zsun2\\AppData\\Roaming\\Python\\Python313\\site-packages\\certifi\\cacert.pem'
2025-03-22 16:57:22,529 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-03-22 16:57:22,530 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\zsun2\\AppData\\Roaming\\Python\\Python313\\site-packages\\certifi\\cacert.pem'
2025-03-22 16:57:22,958 - LiteLLM - DEBUG - [Non-Blocking] Unable to import GenericAPILogger - LiteLLM Enterprise Feature - No module named 'litellm.proxy.enterprise'
2025-03-22 16:57:23,260 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-03-22 16:57:23,261 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\zsun2\\AppData\\Roaming\\Python\\Python313\\site-packages\\certifi\\cacert.pem'
2025-03-22 16:57:23,650 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-03-22 16:57:23,651 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\zsun2\\AppData\\Roaming\\Python\\Python313\\site-packages\\certifi\\cacert.pem'
2025-03-22 16:57:29,758 - memory_debug - INFO - Settings from config:
2025-03-22 16:57:29,759 - memory_debug - INFO -   MODEL_NAME: all-MiniLM-L6-v2
2025-03-22 16:57:29,759 - memory_debug - INFO -   LLM_BACKEND: openai
2025-03-22 16:57:29,759 - memory_debug - INFO -   LLM_MODEL: deepseek-v3-241226
2025-03-22 16:57:29,760 - memory_debug - INFO -   API_KEY: [SET]
2025-03-22 16:57:29,760 - memory_debug - INFO -   API_URL: https://ark.cn-beijing.volces.com/api/v3
2025-03-22 16:57:29,760 - memory_debug - INFO - Initializing AgenticMemorySystem...
2025-03-22 16:57:29,762 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-03-22 16:57:29,762 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-03-22 16:57:29,763 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-03-22 16:57:30,804 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-22 16:57:32,178 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config_sentence_transformers.json HTTP/1.1" 200 0
2025-03-22 16:57:32,511 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/README.md HTTP/1.1" 200 0
2025-03-22 16:57:32,850 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/modules.json HTTP/1.1" 200 0
2025-03-22 16:57:33,185 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/sentence_bert_config.json HTTP/1.1" 200 0
2025-03-22 16:57:33,516 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/adapter_config.json HTTP/1.1" 404 0
2025-03-22 16:57:33,848 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/config.json HTTP/1.1" 200 0
2025-03-22 16:57:34,412 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/all-MiniLM-L6-v2/resolve/main/tokenizer_config.json HTTP/1.1" 200 0
2025-03-22 16:57:35,076 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2/revision/main HTTP/1.1" 200 6729
2025-03-22 16:57:35,509 - urllib3.connectionpool - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/all-MiniLM-L6-v2 HTTP/1.1" 200 6729
2025-03-22 16:57:35,530 - urllib3.util.retry - DEBUG - Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-03-22 16:57:35,538 - chromadb.telemetry.product.posthog - INFO - Anonymized telemetry enabled. See                     https://docs.trychroma.com/telemetry for more information.
2025-03-22 16:57:35,735 - chromadb.config - DEBUG - Starting component System
2025-03-22 16:57:35,736 - chromadb.config - DEBUG - Starting component Posthog
2025-03-22 16:57:35,736 - chromadb.config - DEBUG - Starting component OpenTelemetryClient
2025-03-22 16:57:35,736 - chromadb.config - DEBUG - Starting component SqliteDB
2025-03-22 16:57:35,741 - chromadb.config - DEBUG - Starting component SimpleQuotaEnforcer
2025-03-22 16:57:35,741 - chromadb.config - DEBUG - Starting component SimpleRateLimitEnforcer
2025-03-22 16:57:35,741 - chromadb.config - DEBUG - Starting component LocalSegmentManager
2025-03-22 16:57:35,741 - chromadb.config - DEBUG - Starting component LocalExecutor
2025-03-22 16:57:35,742 - chromadb.config - DEBUG - Starting component SegmentAPI
2025-03-22 16:57:35,777 - chromadb.api.segment - DEBUG - Collection memories already exists, returning existing collection.
2025-03-22 16:57:35,801 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-03-22 16:57:35,802 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\zsun2\\AppData\\Roaming\\Python\\Python313\\site-packages\\certifi\\cacert.pem'
2025-03-22 16:57:36,187 - memory_debug - INFO - Step 1: Testing content analysis...
2025-03-22 16:57:36,188 - memory_debug - INFO - Calling analyze_content...
2025-03-22 16:57:36,188 - memory_system - INFO - LLM disabled, using fallback analysis
2025-03-22 16:57:36,190 - memory_debug - INFO - 
Step 2: Testing basic memory creation...
2025-03-22 16:57:36,190 - memory_debug - INFO - Calling memory_system.create...
2025-03-22 16:57:36,190 - memory_system - INFO - LLM disabled, using fallback analysis
2025-03-22 16:57:36,258 - urllib3.connectionpool - DEBUG - Starting new HTTPS connection (1): us.i.posthog.com:443
2025-03-22 16:57:36,470 - memory_debug - ERROR - Traceback (most recent call last):
  File "C:\Users\zsun2\AppData\Roaming\Python\Python313\site-packages\chromadb\api\models\CollectionCommon.py", line 90, in wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\zsun2\AppData\Roaming\Python\Python313\site-packages\chromadb\api\models\CollectionCommon.py", line 213, in _validate_and_prepare_add_request
    add_embeddings = self._embed_record_set(record_set=add_records)
  File "C:\Users\zsun2\AppData\Roaming\Python\Python313\site-packages\chromadb\api\models\CollectionCommon.py", line 526, in _embed_record_set
    return self._embed(input=record_set[field])  # type: ignore[literal-required]
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zsun2\AppData\Roaming\Python\Python313\site-packages\chromadb\api\models\CollectionCommon.py", line 539, in _embed
    return self._embedding_function(input=input)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\zsun2\AppData\Roaming\Python\Python313\site-packages\chromadb\api\types.py", line 466, in __call__
    result = call(self, input)
  File "C:\Users\zsun2\AppData\Roaming\Python\Python313\site-packages\chromadb\utils\embedding_functions\onnx_mini_lm_l6_v2.py", line 199, in __call__
    self._download_model_if_not_exists()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zsun2\AppData\Roaming\Python\Python313\site-packages\chromadb\utils\embedding_functions\onnx_mini_lm_l6_v2.py", line 234, in _download_model_if_not_exists
    tar.extractall(path=self.DOWNLOAD_PATH)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\tarfile.py", line 2334, in extractall
    self._extract_one(tarinfo, path, set_attrs=not tarinfo.isdir(),
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                      numeric_owner=numeric_owner)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\tarfile.py", line 2401, in _extract_one
    self._handle_fatal_error(e)
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^
  File "C:\Python313\Lib\tarfile.py", line 2397, in _extract_one
    self._extract_member(tarinfo, os.path.join(path, tarinfo.name),
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                         set_attrs=set_attrs,
                         ^^^^^^^^^^^^^^^^^^^^
                         numeric_owner=numeric_owner)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\tarfile.py", line 2480, in _extract_member
    self.makefile(tarinfo, targetpath)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\tarfile.py", line 2526, in makefile
    with bltn_open(targetpath, "wb") as target:
         ~~~~~~~~~^^^^^^^^^^^^^^^^^^
PermissionError: [Errno 13] Permission denied: 'C:\\Users\\zsun2\\.cache\\chroma\\onnx_models\\all-MiniLM-L6-v2\\onnx\\tokenizer_config.json'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\MCP\A-mem\debug_memory_creation.py", line 86, in test_memory_creation_directly
    memory_id = memory_system.create(
        content=test_content,
        tags=["test", "debug"],
        category="Testing"
    )
  File "D:\MCP\A-mem\memory_system.py", line 427, in create
    self.chroma_retriever.add_document(document=content, metadata=metadata, doc_id=note.id)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\MCP\A-mem\retrievers.py", line 124, in add_document
    self.collection.add(
    ~~~~~~~~~~~~~~~~~~~^
        documents=[document],
        ^^^^^^^^^^^^^^^^^^^^^
        metadatas=[processed_metadata],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ids=[doc_id]
        ^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zsun2\AppData\Roaming\Python\Python313\site-packages\chromadb\api\models\Collection.py", line 82, in add
    add_request = self._validate_and_prepare_add_request(
        ids=ids,
    ...<4 lines>...
        uris=uris,
    )
  File "C:\Users\zsun2\AppData\Roaming\Python\Python313\site-packages\chromadb\api\models\CollectionCommon.py", line 93, in wrapper
    raise type(e)(msg).with_traceback(e.__traceback__)
  File "C:\Users\zsun2\AppData\Roaming\Python\Python313\site-packages\chromadb\api\models\CollectionCommon.py", line 90, in wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\zsun2\AppData\Roaming\Python\Python313\site-packages\chromadb\api\models\CollectionCommon.py", line 213, in _validate_and_prepare_add_request
    add_embeddings = self._embed_record_set(record_set=add_records)
  File "C:\Users\zsun2\AppData\Roaming\Python\Python313\site-packages\chromadb\api\models\CollectionCommon.py", line 526, in _embed_record_set
    return self._embed(input=record_set[field])  # type: ignore[literal-required]
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zsun2\AppData\Roaming\Python\Python313\site-packages\chromadb\api\models\CollectionCommon.py", line 539, in _embed
    return self._embedding_function(input=input)
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\zsun2\AppData\Roaming\Python\Python313\site-packages\chromadb\api\types.py", line 466, in __call__
    result = call(self, input)
  File "C:\Users\zsun2\AppData\Roaming\Python\Python313\site-packages\chromadb\utils\embedding_functions\onnx_mini_lm_l6_v2.py", line 199, in __call__
    self._download_model_if_not_exists()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zsun2\AppData\Roaming\Python\Python313\site-packages\chromadb\utils\embedding_functions\onnx_mini_lm_l6_v2.py", line 234, in _download_model_if_not_exists
    tar.extractall(path=self.DOWNLOAD_PATH)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\tarfile.py", line 2334, in extractall
    self._extract_one(tarinfo, path, set_attrs=not tarinfo.isdir(),
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                      numeric_owner=numeric_owner)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\tarfile.py", line 2401, in _extract_one
    self._handle_fatal_error(e)
    ~~~~~~~~~~~~~~~~~~~~~~~~^^^
  File "C:\Python313\Lib\tarfile.py", line 2397, in _extract_one
    self._extract_member(tarinfo, os.path.join(path, tarinfo.name),
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                         set_attrs=set_attrs,
                         ^^^^^^^^^^^^^^^^^^^^
                         numeric_owner=numeric_owner)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\tarfile.py", line 2480, in _extract_member
    self.makefile(tarinfo, targetpath)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python313\Lib\tarfile.py", line 2526, in makefile
    with bltn_open(targetpath, "wb") as target:
         ~~~~~~~~~^^^^^^^^^^^^^^^^^^
PermissionError: [Errno 13] Permission denied: 'C:\\Users\\zsun2\\.cache\\chroma\\onnx_models\\all-MiniLM-L6-v2\\onnx\\tokenizer_config.json' in add.

2025-03-22 16:57:36,470 - memory_debug - ERROR - Direct memory creation test failed.
2025-03-22 16:57:37,380 - urllib3.connectionpool - DEBUG - https://us.i.posthog.com:443 "POST /batch/ HTTP/1.1" 200 15
